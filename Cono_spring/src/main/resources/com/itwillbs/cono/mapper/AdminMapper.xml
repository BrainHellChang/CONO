<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.cono.mapper.AdminMapper">


	<!-- 공지사항 총 게시물 수 조회(검색 기능 추가) -->
	<select id="selectNoticeListCount"
		resultType="java.lang.Integer">
		SELECT COUNT(*) FROM notice
		<choose>
			<when test="!search.equals('') and searchType.equals('subject')">
				WHERE notice_subject LIKE #{search}
			</when>
			<when test="!search.equals('') and searchType.equals('content')">
				WHERE notice_content LIKE #{search}
			</when>
		</choose>
	</select>

	<!-- 공지사항 목록 조회 -->
	<select id="selectNoticeList"
		resultType="com.itwillbs.cono.vo.AdminNoticeDTO">
		SELECT * FROM notice
		<choose>
			<when test="!search.equals('') and searchType.equals('subject')">
				WHERE notice_subject LIKE #{search}
			</when>
			<when test="!search.equals('') and searchType.equals('content')">
				WHERE notice_content LIKE #{search}
			</when>
		</choose>
		ORDER BY notice_idx+0 DESC
		LIMIT #{pageInfo.startRow},
		#{pageInfo.listLimit}
	</select>

	<!-- 공지사항 글쓰기 -->
	<insert id="insertNotice">
		INSERT INTO notice
		VALUES (1+(SELECT
		COUNT(n.notice_idx) FROM notice n ), #{admin_id}, #{notice_subject},
		#{notice_content}, DATE_FORMAT(now(), "%Y%m%d") )
	</insert>

	<!-- 공지사항 상세페이지 -->
	<select id="selectNoticeView"
		resultType="com.itwillbs.cono.vo.AdminNoticeDTO">
		SELECT * FROM notice WHERE notice_idx=#{notice_idx}
	</select>

	<!-- 공지사항 삭제 -->
	<delete id="deleteNoticeList">
		DELETE FROM notice WHERE notice_idx=#{notice_idx}
	</delete>

	<!-- 공지사항 수정 -->
	<update id="updateNotice">
		UPDATE notice SET admin_id=#{admin_id},notice_subject=#{notice_subject},notice_content=#{notice_content} 
		WHERE notice_idx=#{notice_idx}
	</update>
	
	
	<!-- qna -->
	<select id="selectQNAListCount" resultType="java.lang.Integer">
	SELECT COUNT(*) FROM qna
	</select>
	
	<!-- qna 목록 조회 -->
	<select id="selectQNAList"
		resultType="com.itwillbs.cono.vo.AdminQNADTO">
		SELECT @rownum:=@rownum-1 AS num
				, A.qna_idx
					, A.member_id
					, A.qna_type
					, A.qna_subject
					, A.qna_content
					, A.qna_date
					, A.qna_status
					, A.qna_re_ref
					, A.qna_re_lev
					, A.qna_re_seq
					 FROM qna A
					, (SELECT @rownum:=(SELECT COUNT(*)+1 FROM qna)) TMP
					 ORDER BY qna_re_ref+0 DESC LIMIT #{pageInfo.startRow},#{pageInfo.listLimit}
	</select>

	<!-- qna 글쓰기 -->
	<select id="selectQNANumDate" resultType="java.lang.String">
		SELECT IFNULL(MAX(CAST(qna_idx as unsigned)), 0) + 1 AS num FROM qna
	</select>

	<insert id="insertQNA">
		INSERT INTO qna VALUES (#{num},#{sId},#{qna_type},#{qna_subject},#{qna_content},#{num},'0','0',DATE_FORMAT(now(), "%Y%m%d"),'답변대기')
	</insert>

	<!-- qna 상세페이지 -->
<!-- 	<select id="selectQNAView" -->
<!-- 		resultType="com.itwillbs.cono.vo.AdminQNADTO"> -->
<!-- 		SELECT * FROM qna WHERE qna_idx=#{qna_idx} -->
<!-- 	</select> -->

<!-- 	 qna 삭제 --> 
<!-- 	<delete id="deleteQNAList"> -->
<!-- 		DELETE FROM qna WHERE qna_idx=#{qna_idx} -->
<!-- 	</delete> -->

<!-- 	 qna 수정 -->
<!-- 	<update id="updateQNA"> -->
<!-- 		UPDATE qna SET admin_id=#{admin_id},notice_subject=#{notice_subject},notice_content=#{notice_content}  -->
<!-- 		WHERE notice_idx=#{notice_idx} -->
<!-- 	</update> -->
	
	
	
	
</mapper>